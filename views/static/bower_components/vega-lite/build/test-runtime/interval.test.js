"use strict";
var __assign = (this && this.__assign) || Object.assign || function(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
        s = arguments[i];
        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
            t[p] = s[p];
    }
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var chai_1 = require("chai");
var util_1 = require("./util");
describe('interval selections at runtime in unit views', function () {
    var type = 'interval';
    var hits = util_1.hits.interval;
    var embed = util_1.embedFn(browser);
    var testRender = util_1.testRenderFn(browser, type + "/unit");
    it('should add extents to the store', function () {
        for (var i = 0; i < hits.drag.length; i++) {
            embed(util_1.spec('unit', i, { type: type }));
            var store = browser.execute(util_1.brush('drag', i)).value;
            chai_1.assert.lengthOf(store, 1);
            chai_1.assert.lengthOf(store[0].intervals, 2);
            chai_1.assert.equal(store[0].intervals[0].encoding, 'x');
            chai_1.assert.equal(store[0].intervals[0].field, 'a');
            chai_1.assert.equal(store[0].intervals[1].encoding, 'y');
            chai_1.assert.equal(store[0].intervals[1].field, 'b');
            chai_1.assert.lengthOf(store[0].intervals[0].extent, 2);
            chai_1.assert.lengthOf(store[0].intervals[1].extent, 2);
            testRender("drag_" + i);
        }
    });
    it('should respect projections', function () {
        embed(util_1.spec('unit', 0, { type: type, encodings: ['x'] }));
        for (var i = 0; i < hits.drag.length; i++) {
            var store = browser.execute(util_1.brush('drag', i)).value;
            chai_1.assert.lengthOf(store, 1);
            chai_1.assert.lengthOf(store[0].intervals, 1);
            chai_1.assert.equal(store[0].intervals[0].encoding, 'x');
            chai_1.assert.equal(store[0].intervals[0].field, 'a');
            chai_1.assert.lengthOf(store[0].intervals[0].extent, 2);
            testRender("x_" + i);
        }
        embed(util_1.spec('unit', 1, { type: type, encodings: ['y'] }));
        for (var i = 0; i < hits.drag.length; i++) {
            var store = browser.execute(util_1.brush('drag', i)).value;
            chai_1.assert.lengthOf(store, 1);
            chai_1.assert.lengthOf(store[0].intervals, 1);
            chai_1.assert.equal(store[0].intervals[0].encoding, 'y');
            chai_1.assert.equal(store[0].intervals[0].field, 'b');
            chai_1.assert.lengthOf(store[0].intervals[0].extent, 2);
            testRender("y_" + i);
        }
    });
    it('should clear out stored extents', function () {
        for (var i = 0; i < hits.drag_clear.length; i++) {
            embed(util_1.spec('unit', i, { type: type }));
            var store = browser.execute(util_1.brush('drag', i)).value;
            chai_1.assert.lengthOf(store, 1);
            store = browser.execute(util_1.brush('drag_clear', i)).value;
            chai_1.assert.lengthOf(store, 0);
            testRender("clear_" + i);
        }
    });
    it('should brush over binned domains', function () {
        embed(util_1.spec('unit', 1, { type: type, encodings: ['y'] }, {
            x: { aggregate: 'count', field: '*', type: 'quantitative' },
            y: { bin: true },
            color: { value: 'steelblue', field: null, type: null }
        }));
        for (var i = 0; i < hits.bins.length; i++) {
            var store_1 = browser.execute(util_1.brush('bins', i)).value;
            chai_1.assert.lengthOf(store_1, 1);
            chai_1.assert.lengthOf(store_1[0].intervals, 1);
            // length == 2 indicates a quantitative scale was inverted.
            chai_1.assert.lengthOf(store_1[0].intervals[0].extent, 2);
            testRender("bins_" + i);
        }
        var store = browser.execute(util_1.brush('bins_clear', 0)).value;
        chai_1.assert.lengthOf(store, 0);
    });
    it('should brush over ordinal/nominal domains', function () {
        var xextents = [[2, 3, 4], [6, 7, 8]];
        var yextents = [[48, 49, 52, 53, 54, 55, 66, 67, 68, 76, 81, 87, 91],
            [16, 17, 19, 23, 24, 27, 28, 35, 39, 43, 48]];
        for (var i = 0; i < hits.drag.length; i++) {
            embed(util_1.spec('unit', i, { type: type }, { x: { type: 'ordinal' }, y: { type: 'nominal' } }));
            var store_2 = browser.execute(util_1.brush('drag', i)).value;
            chai_1.assert.lengthOf(store_2, 1);
            chai_1.assert.lengthOf(store_2[0].intervals, 2);
            chai_1.assert.sameMembers(store_2[0].intervals[0].extent, xextents[i]);
            chai_1.assert.sameMembers(store_2[0].intervals[1].extent, yextents[i]);
            testRender("ord_" + i);
        }
        var store = browser.execute(util_1.brush('drag_clear', 0)).value;
        chai_1.assert.lengthOf(store, 0);
    });
    it('should brush over temporal domains', function () {
        var values = util_1.tuples.map(function (d) { return (__assign({}, d, { a: new Date(2017, d.a) })); });
        var toNumber = '[0].intervals[0].extent.map((d) => +d)';
        embed(util_1.spec('unit', 0, { type: type, encodings: ['x'] }, { values: values, x: { type: 'temporal' } }));
        var extents = [[1485969714000, 1493634384000], [1496346498000, 1504364922000]];
        for (var i = 0; i < hits.drag.length; i++) {
            var store = browser.execute(util_1.brush('drag', i) + toNumber).value;
            chai_1.assert.sameMembers(store, extents[i]);
            testRender("temporal_" + i);
        }
        var cleared = browser.execute(util_1.brush('drag_clear', 0)).value;
        chai_1.assert.lengthOf(cleared, 0);
        embed(util_1.spec('unit', 1, { type: type, encodings: ['x'] }, { values: values, x: { type: 'temporal', timeUnit: 'day' } }));
        extents = [[1136190528000, 1136361600000], [1136449728000, 1136535264000]];
        for (var i = 0; i < hits.drag.length; i++) {
            var store = browser.execute(util_1.brush('drag', i) + toNumber).value;
            chai_1.assert.sameMembers(store, extents[i]);
            testRender("dayTimeUnit_" + i);
        }
        cleared = browser.execute(util_1.brush('drag_clear', 0)).value;
        chai_1.assert.lengthOf(cleared, 0);
    });
    it('should brush over log/pow scales', function () {
        for (var i = 0; i < hits.drag.length; i++) {
            embed(util_1.spec('unit', i, { type: type }, {
                x: { scale: { type: 'pow', exponent: 1.5 } },
                y: { scale: { type: 'log' } }
            }));
            var store = browser.execute(util_1.brush('drag', i)).value;
            chai_1.assert.lengthOf(store, 1);
            chai_1.assert.lengthOf(store[0].intervals, 2);
            chai_1.assert.lengthOf(store[0].intervals[0].extent, 2);
            chai_1.assert.lengthOf(store[0].intervals[1].extent, 2);
            testRender("logpow_" + i);
        }
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW50ZXJ2YWwudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3Rlc3QtcnVudGltZS9pbnRlcnZhbC50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSw2QkFBNEI7QUFDNUIsK0JBQXNGO0FBRXRGLFFBQVEsQ0FBQyw4Q0FBOEMsRUFBRTtJQUN2RCxJQUFNLElBQUksR0FBRyxVQUFVLENBQUM7SUFDeEIsSUFBTSxJQUFJLEdBQUcsV0FBVSxDQUFDLFFBQVEsQ0FBQztJQUNqQyxJQUFNLEtBQUssR0FBRyxjQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDL0IsSUFBTSxVQUFVLEdBQUcsbUJBQVksQ0FBQyxPQUFPLEVBQUssSUFBSSxVQUFPLENBQUMsQ0FBQztJQUV6RCxFQUFFLENBQUMsaUNBQWlDLEVBQUU7UUFDcEMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQzFDLEtBQUssQ0FBQyxXQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFDLElBQUksTUFBQSxFQUFDLENBQUMsQ0FBQyxDQUFDO1lBQy9CLElBQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsWUFBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztZQUN0RCxhQUFNLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztZQUMxQixhQUFNLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDdkMsYUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMs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TSxLQUFLLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxZQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1lBQ3RELGFBQU0sQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzFCLGFBQU0sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUN2QyxhQUFNLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ2pELGFBQU0sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDakQsVUFBVSxDQUFDLFlBQVUsQ0FBRyxDQUFDLENBQUM7UUFDNUIsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2Fzc2VydH0gZnJvbSAnY2hhaSc7XG5pbXBvcnQge2JydXNoLCBlbWJlZEZuLCBoaXRzIGFzIGhpdHNNYXN0ZXIsIHNwZWMsIHRlc3RSZW5kZXJGbiwgdHVwbGVzfSBmcm9tICcuL3V0aWwnO1xuXG5kZXNjcmliZSgnaW50ZXJ2YWwgc2VsZWN0aW9ucyBhdCBydW50aW1lIGluIHVuaXQgdmlld3MnLCBmdW5jdGlvbigpIHtcbiAgY29uc3QgdHlwZSA9ICdpbnRlcnZhbCc7XG4gIGNvbnN0IGhpdHMgPSBoaXRzTWFzdGVyLmludGVydmFsO1xuICBjb25zdCBlbWJlZCA9IGVtYmVkRm4oYnJvd3Nlcik7XG4gIGNvbnN0IHRlc3RSZW5kZXIgPSB0ZXN0UmVuZGVyRm4oYnJvd3NlciwgYCR7dHlwZX0vdW5pdGApO1xuXG4gIGl0KCdzaG91bGQgYWRkIGV4dGVudHMgdG8gdGhlIHN0b3JlJywgZnVuY3Rpb24oKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBoaXRzLmRyYWcubGVuZ3RoOyBpKyspIHtcbiAgICAgIGVtYmVkKHNwZWMoJ3VuaXQnLCBpLCB7dHlwZX0pKTtcbiAgICAgIGNvbnN0IHN0b3JlID0gYnJvd3Nlci5leGVjdXRlKGJydXNoKCdkcmFnJywgaSkpLnZhbHVlO1xuICAgICAgYXNzZXJ0Lmxlbmd0aE9mKHN0b3JlLCAxKTtcbiAgICAgIGFzc2VydC5sZW5ndGhPZihzdG9yZVswXS5pbnRlcnZhbHMsIDIpO1xuICAgICAgYXNzZXJ0LmVxdWFsKHN0b3JlWzBdLmludGVydmFsc1swXS5lbmNvZGluZywgJ3gnKTtcbiAgICAgIGFzc2VydC5lcXVhbChzdG9yZVswXS5pbnRlcnZhbHNbMF0uZmllbGQsICdhJyk7XG4gICAgICBhc3NlcnQuZXF1YWwoc3RvcmVbMF0uaW50ZXJ2YWxzWzFdLmVuY29kaW5nLCAneScpO1xuICAgICAgYXNzZXJ0LmVxdWFsKHN0b3JlWzBdLmludGVydmFsc1sxXS5maWVsZCwgJ2InKTtcbiAgICAgIGFzc2VydC5sZW5ndGhPZihzdG9yZVswXS5pbnRlcnZhbHNbMF0uZXh0ZW50LCAyKTtcbiAgICAgIGFzc2VydC5sZW5ndGhPZihzdG9yZVswXS5pbnRlcnZhbHNbMV0uZXh0ZW50LCAyKTtcbiAgICAgIHRlc3RSZW5kZXIoYGRyYWdfJHtpfWApO1xuICAgIH1cbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCByZXNwZWN0IHByb2plY3Rpb25zJywgZnVuY3Rpb24oKSB7XG4gICAgZW1iZWQoc3BlYygndW5pdCcsIDAsIHt0eXBlLCBlbmNvZGluZ3M6IFsneCddfSkpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaGl0cy5kcmFnLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBzdG9yZSA9IGJyb3dzZXIuZXhlY3V0ZShicnVzaCgnZHJhZycsIGkpKS52YWx1ZTtcbiAgICAgIGFzc2VydC5sZW5ndGhPZihzdG9yZSwgMSk7XG4gICAgICBhc3NlcnQubGVuZ3RoT2Yoc3RvcmVbMF0uaW50ZXJ2YWxzLCAxKTtcbiAgICAgIGFzc2VydC5lcXVhbChzdG9yZVswXS5pbnRlcnZhbHNbMF0uZW5jb2RpbmcsICd4Jyk7XG4gICAgICBhc3NlcnQuZXF1YWwoc3RvcmVbMF0uaW50ZXJ2YWxzWzBdLmZpZWxkLCAnYScpO1xuICAgICAgYXNzZXJ0Lmxlbmd0aE9mKHN0b3JlWzBdLmludGVydmFsc1swXS5leHRlbnQsIDIpO1xuICAgICAgdGVzdFJlbmRlcihgeF8ke2l9YCk7XG4gICAgfVxuXG4gICAgZW1iZWQoc3BlYygndW5pdCcsIDEsIHt0eXBlLCBlbmNvZGluZ3M6IFsneSddfSkpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaGl0cy5kcmFnLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBzdG9yZSA9IGJyb3dzZXIuZXhlY3V0ZShicnVzaCgnZHJhZycsIGkpKS52YWx1ZTtcbiAgICAgIGFzc2VydC5sZW5ndGhPZihzdG9yZSwgMSk7XG4gICAgICBhc3NlcnQubGVuZ3RoT2Yoc3RvcmVbMF0uaW50ZXJ2YWxzLCAxKTtcbiAgICAgIGFzc2VydC5lcXVhbChzdG9yZVswXS5pbnRlcnZhbHNbMF0uZW5jb2RpbmcsICd5Jyk7XG4gICAgICBhc3NlcnQuZXF1YWwoc3RvcmVbMF0uaW50ZXJ2YWxzWzBdLmZpZWxkLCAnYicpO1xuICAgICAgYXNzZXJ0Lmxlbmd0aE9mKHN0b3JlWzBdLmludGVydmFsc1swXS5leHRlbnQsIDIpO1xuICAgICAgdGVzdFJlbmRlcihgeV8ke2l9YCk7XG4gICAgfVxuICB9KTtcblxuICBpdCgnc2hvdWxkIGNsZWFyIG91dCBzdG9yZWQgZXh0ZW50cycsIGZ1bmN0aW9uKCkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaGl0cy5kcmFnX2NsZWFyLmxlbmd0aDsgaSsrKSB7XG4gICAgICBlbWJlZChzcGVjKCd1bml0JywgaSwge3R5cGV9KSk7XG4gICAgICBsZXQgc3RvcmUgPSBicm93c2VyLmV4ZWN1dGUoYnJ1c2goJ2RyYWcnLCBpKSkudmFsdWU7XG4gICAgICBhc3NlcnQubGVuZ3RoT2Yoc3RvcmUsIDEpO1xuXG4gICAgICBzdG9yZSA9IGJyb3dzZXIuZXhlY3V0ZShicnVzaCgnZHJhZ19jbGVhcicsIGkpKS52YWx1ZTtcbiAgICAgIGFzc2VydC5sZW5ndGhPZihzdG9yZSwgMCk7XG4gICAgICB0ZXN0UmVuZGVyKGBjbGVhcl8ke2l9YCk7XG4gICAgfVxuICB9KTtcblxuICBpdCgnc2hvdWxkIGJydXNoIG92ZXIgYmlubmVkIGRvbWFpbnMnLCBmdW5jdGlvbigpIHtcbiAgICBlbWJlZChzcGVjKCd1bml0JywgMSwge3R5cGUsIGVuY29kaW5nczogWyd5J119LCB7XG4gICAgICB4OiB7YWdncmVnYXRlOiAnY291bnQnLCBmaWVsZDogJyonLCB0eXBlOiAncXVhbnRpdGF0aXZlJ30sXG4gICAgICB5OiB7YmluOiB0cnVlfSxcbiAgICAgIGNvbG9yOiB7dmFsdWU6ICdzdGVlbGJsdWUnLCBmaWVsZDogbnVsbCwgdHlwZTogbnVsbH1cbiAgICB9KSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBoaXRzLmJpbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHN0b3JlID0gYnJvd3Nlci5leGVjdXRlKGJydXNoKCdiaW5zJywgaSkpLnZhbHVlO1xuICAgICAgYXNzZXJ0Lmxlbmd0aE9mKHN0b3JlLCAxKTtcbiAgICAgIGFzc2VydC5sZW5ndGhPZihzdG9yZVswXS5pbnRlcnZhbHMsIDEpO1xuICAgICAgLy8gbGVuZ3RoID09IDIgaW5kaWNhdGVzIGEgcXVhbnRpdGF0aXZlIHNjYWxlIHdhcyBpbnZlcnRlZC5cbiAgICAgIGFzc2VydC5sZW5ndGhPZihzdG9yZVswXS5pbnRlcnZhbHNbMF0uZXh0ZW50LCAyKTtcbiAgICAgIHRlc3RSZW5kZXIoYGJpbnNfJHtpfWApO1xuICAgIH1cblxuICAgIGNvbnN0IHN0b3JlID0gYnJvd3Nlci5leGVjdXRlKGJydXNoKCdiaW5zX2NsZWFyJywgMCkpLnZhbHVlO1xuICAgIGFzc2VydC5sZW5ndGhPZihzdG9yZSwgMCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgYnJ1c2ggb3ZlciBvcmRpbmFsL25vbWluYWwgZG9tYWlucycsIGZ1bmN0aW9uKCkge1xuICAgIGNvbnN0IHhleHRlbnRzID0gW1syLCAzLCA0XSwgWzYsIDcsIDhdXTtcbiAgICBjb25zdCB5ZXh0ZW50cyA9IFtbNDgsIDQ5LCA1MiwgNTMsIDU0LCA1NSwgNjYsIDY3LCA2OCwgNzYsIDgxLCA4NywgOTFdLFxuICAgICAgWzE2LCAxNywgMTksIDIzLCAyNCwgMjcsIDI4LCAzNSwgMzksIDQzLCA0OF1dO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBoaXRzLmRyYWcubGVuZ3RoOyBpKyspIHtcbiAgICAgIGVtYmVkKHNwZWMoJ3VuaXQnLCBpLCB7dHlwZX0sXG4gICAgICAgIHt4OiB7dHlwZTogJ29yZGluYWwnfSwgeToge3R5cGU6ICdub21pbmFsJ319KSk7XG4gICAgICBjb25zdCBzdG9yZSA9IGJyb3dzZXIuZXhlY3V0ZShicnVzaCgnZHJhZycsIGkpKS52YWx1ZTtcbiAgICAgIGFzc2VydC5sZW5ndGhPZihzdG9yZSwgMSk7XG4gICAgICBhc3NlcnQubGVuZ3RoT2Yoc3RvcmVbMF0uaW50ZXJ2YWxzLCAyKTtcbiAgICAgIGFzc2VydC5zYW1lTWVtYmVycyhzdG9yZVswXS5pbnRlcnZhbHNbMF0uZXh0ZW50LCB4ZXh0ZW50c1tpXSk7XG4gICAgICBhc3NlcnQuc2FtZU1lbWJlcnMoc3RvcmVbMF0uaW50ZXJ2YWxzWzFdLmV4dGVudCwgeWV4dGVudHNbaV0pO1xuICAgICAgdGVzdFJlbmRlcihgb3JkXyR7aX1gKTtcbiAgICB9XG5cbiAgICBjb25zdCBzdG9yZSA9IGJyb3dzZXIuZXhlY3V0ZShicnVzaCgnZHJhZ19jbGVhcicsIDApKS52YWx1ZTtcbiAgICBhc3NlcnQubGVuZ3RoT2Yoc3RvcmUsIDApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGJydXNoIG92ZXIgdGVtcG9yYWwgZG9tYWlucycsIGZ1bmN0aW9uKCkge1xuICAgIGNvbnN0IHZhbHVlcyA9IHR1cGxlcy5tYXAoKGQpID0+ICh7Li4uZCwgYTogbmV3IERhdGUoMjAxNywgZC5hKX0pKTtcbiAgICBjb25zdCB0b051bWJlciA9ICdbMF0uaW50ZXJ2YWxzWzBdLmV4dGVudC5tYXAoKGQpID0+ICtkKSc7XG5cbiAgICBlbWJlZChzcGVjKCd1bml0JywgMCwge3R5cGUsIGVuY29kaW5nczogWyd4J119LCB7dmFsdWVzLCB4OiB7dHlwZTogJ3RlbXBvcmFsJ319KSk7XG4gICAgbGV0IGV4dGVudHMgPSBbWzE0ODU5Njk3MTQwMDAsIDE0OTM2MzQzODQwMDBdLCBbMTQ5NjM0NjQ5ODAwMCwgMTUwNDM2NDkyMjAwMF1dO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaGl0cy5kcmFnLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBzdG9yZSA9IGJyb3dzZXIuZXhlY3V0ZShicnVzaCgnZHJhZycsIGkpICsgdG9OdW1iZXIpLnZhbHVlO1xuICAgICAgYXNzZXJ0LnNhbWVNZW1iZXJzKHN0b3JlLCBleHRlbnRzW2ldKTtcbiAgICAgIHRlc3RSZW5kZXIoYHRlbXBvcmFsXyR7aX1gKTtcbiAgICB9XG5cbiAgICBsZXQgY2xlYXJlZCA9IGJyb3dzZXIuZXhlY3V0ZShicnVzaCgnZHJhZ19jbGVhcicsIDApKS52YWx1ZTtcbiAgICBhc3NlcnQubGVuZ3RoT2YoY2xlYXJlZCwgMCk7XG5cbiAgICBlbWJlZChzcGVjKCd1bml0JywgMSwge3R5cGUsIGVuY29kaW5nczogWyd4J119LCB7dmFsdWVzLCB4OiB7dHlwZTogJ3RlbXBvcmFsJywgdGltZVVuaXQ6ICdkYXknfX0pKTtcblxuICAgIGV4dGVudHMgPSBbWzExMzYxOTA1MjgwMDAsIDExMzYzNjE2MDAwMDBdLCBbMTEzNjQ0OTcyODAwMCwgMTEzNjUzNTI2NDAwMF1dO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaGl0cy5kcmFnLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBzdG9yZSA9IGJyb3dzZXIuZXhlY3V0ZShicnVzaCgnZHJhZycsIGkpICsgdG9OdW1iZXIpLnZhbHVlO1xuICAgICAgYXNzZXJ0LnNhbWVNZW1iZXJzKHN0b3JlLCBleHRlbnRzW2ldKTtcbiAgICAgIHRlc3RSZW5kZXIoYGRheVRpbWVVbml0XyR7aX1gKTtcbiAgICB9XG5cbiAgICBjbGVhcmVkID0gYnJvd3Nlci5leGVjdXRlKGJydXNoKCdkcmFnX2NsZWFyJywgMCkpLnZhbHVlO1xuICAgIGFzc2VydC5sZW5ndGhPZihjbGVhcmVkLCAwKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBicnVzaCBvdmVyIGxvZy9wb3cgc2NhbGVzJywgZnVuY3Rpb24oKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBoaXRzLmRyYWcubGVuZ3RoOyBpKyspIHtcbiAgICAgIGVtYmVkKHNwZWMoJ3VuaXQnLCBpLCB7dHlwZX0sIHtcbiAgICAgICAgeDoge3NjYWxlOiB7dHlwZTogJ3BvdycsIGV4cG9uZW50OiAxLjV9fSxcbiAgICAgICAgeToge3NjYWxlOiB7dHlwZTogJ2xvZyd9fVxuICAgICAgfSkpO1xuICAgICAgY29uc3Qgc3RvcmUgPSBicm93c2VyLmV4ZWN1dGUoYnJ1c2goJ2RyYWcnLCBpKSkudmFsdWU7XG4gICAgICBhc3NlcnQubGVuZ3RoT2Yoc3RvcmUsIDEpO1xuICAgICAgYXNzZXJ0Lmxlbmd0aE9mKHN0b3JlWzBdLmludGVydmFscywgMik7XG4gICAgICBhc3NlcnQubGVuZ3RoT2Yoc3RvcmVbMF0uaW50ZXJ2YWxzWzBdLmV4dGVudCwgMik7XG4gICAgICBhc3NlcnQubGVuZ3RoT2Yoc3RvcmVbMF0uaW50ZXJ2YWxzWzFdLmV4dGVudCwgMik7XG4gICAgICB0ZXN0UmVuZGVyKGBsb2dwb3dfJHtpfWApO1xuICAgIH1cbiAgfSk7XG59KTtcbiJdfQ==