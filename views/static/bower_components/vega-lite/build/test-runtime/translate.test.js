"use strict";
var __assign = (this && this.__assign) || Object.assign || function(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
        s = arguments[i];
        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
            t[p] = s[p];
    }
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var chai_1 = require("chai");
var util_1 = require("./util");
[util_1.bound, util_1.unbound].forEach(function (bind, idx) {
    describe("Translate " + bind + " interval selections at runtime", function () {
        var type = 'interval';
        var hits = util_1.hits.interval;
        var embed = util_1.embedFn(browser);
        var testRender = util_1.testRenderFn(browser, "interval/translate/" + bind);
        var binding = bind === util_1.bound ? { bind: 'scales' } : {};
        var assertExtent = (_a = {},
            _a[util_1.unbound] = {
                x: ['isAbove', 'isBelow'],
                y: ['isBelow', 'isAbove']
            },
            _a[util_1.bound] = {
                x: ['isBelow', 'isAbove'],
                y: ['isAbove', 'isBelow']
            },
            _a);
        it('should move back-and-forth', function () {
            for (var i = 0; i < hits.translate.length; i++) {
                embed(util_1.spec('unit', i, __assign({ type: type }, binding)));
                var drag = browser.execute(util_1.brush('drag', i)).value[0];
                testRender(i + "-0");
                var translate = browser.execute(util_1.brush('translate', i, null, bind === util_1.unbound)).value[0];
                chai_1.assert[assertExtent[bind].x[i]](translate.intervals[0].extent[0], drag.intervals[0].extent[0]);
                chai_1.assert[assertExtent[bind].x[i]](translate.intervals[0].extent[1], drag.intervals[0].extent[1]);
                chai_1.assert[assertExtent[bind].y[i]](translate.intervals[1].extent[0], drag.intervals[1].extent[0]);
                chai_1.assert[assertExtent[bind].y[i]](translate.intervals[1].extent[1], drag.intervals[1].extent[1]);
                testRender(i + "-1");
            }
        });
        it('should work with binned domains', function () {
            for (var i = 0; i < hits.bins.length; i++) {
                embed(util_1.spec('unit', 1, __assign({ type: type }, binding, { encodings: ['y'] }), {
                    x: { aggregate: 'count', field: '*', type: 'quantitative' },
                    y: { bin: true },
                    color: { value: 'steelblue', field: null, type: null }
                }));
                var drag = browser.execute(util_1.brush('bins', i)).value[0];
                testRender("bins_" + i + "-0");
                var translate = browser.execute(util_1.brush('bins_translate', i, null, bind === util_1.unbound)).value[0];
                chai_1.assert[assertExtent[bind].y[i]](translate.intervals[0].extent[0], drag.intervals[0].extent[0]);
                chai_1.assert[assertExtent[bind].y[i]](translate.intervals[0].extent[1], drag.intervals[0].extent[1]);
                testRender("bins_" + i + "-1");
            }
        });
        it('should work with temporal domains', function () {
            var values = util_1.tuples.map(function (d) { return (__assign({}, d, { a: new Date(2017, d.a) })); });
            var toNumber = '[0].intervals[0].extent.map((d) => +d)';
            for (var i = 0; i < hits.translate.length; i++) {
                embed(util_1.spec('unit', i, __assign({ type: type }, binding, { encodings: ['x'] }), { values: values, x: { type: 'temporal' } }));
                var drag = browser.execute(util_1.brush('drag', i) + toNumber).value;
                testRender("temporal_" + i + "-0");
                var translate = browser.execute(util_1.brush('translate', i, null, bind === util_1.unbound) + toNumber).value;
                chai_1.assert[assertExtent[bind].x[i]](translate[0], drag[0]);
                chai_1.assert[assertExtent[bind].x[i]](translate[1], drag[1]);
                testRender("temporal_" + i + "-1");
            }
        });
        it('should work with log/pow scales', function () {
            for (var i = 0; i < hits.translate.length; i++) {
                embed(util_1.spec('unit', i, __assign({ type: type }, binding), {
                    x: { scale: { type: 'pow', exponent: 1.5 } },
                    y: { scale: { type: 'log' } }
                }));
                var drag = browser.execute(util_1.brush('drag', i)).value[0];
                testRender("logpow_" + i + "-0");
                var translate = browser.execute(util_1.brush('translate', i, null, bind === util_1.unbound)).value[0];
                chai_1.assert[assertExtent[bind].x[i]](translate.intervals[0].extent[0], drag.intervals[0].extent[0]);
                chai_1.assert[assertExtent[bind].x[i]](translate.intervals[0].extent[1], drag.intervals[0].extent[1]);
                chai_1.assert[assertExtent[bind].y[i]](translate.intervals[1].extent[0], drag.intervals[1].extent[0]);
                chai_1.assert[assertExtent[bind].y[i]](translate.intervals[1].extent[1], drag.intervals[1].extent[1]);
                testRender("logpow_" + i + "-1");
            }
        });
        if (bind === util_1.unbound) {
            it('should work with ordinal/nominal domains', function () {
                for (var i = 0; i < hits.translate.length; i++) {
                    embed(util_1.spec('unit', i, __assign({ type: type }, binding), {
                        x: { type: 'ordinal' }, y: { type: 'nominal' }
                    }));
                    var drag = browser.execute(util_1.brush('drag', i)).value[0];
                    testRender("ord_" + i + "-0");
                    var translate = browser.execute(util_1.brush('translate', i, null, true)).value[0];
                    chai_1.assert[assertExtent[bind].x[i]](translate.intervals[0].extent[0], drag.intervals[0].extent[0]);
                    chai_1.assert[assertExtent[bind].x[i]](translate.intervals[0].extent[1], drag.intervals[0].extent[1]);
                    chai_1.assert[assertExtent[bind].y[i]](translate.intervals[1].extent[0], drag.intervals[1].extent[0]);
                    chai_1.assert[assertExtent[bind].y[i]](translate.intervals[1].extent[1], drag.intervals[1].extent[1]);
                    testRender("ord_" + i + "-1");
                }
            });
        }
        else {
            util_1.compositeTypes.forEach(function (specType) {
                var assertExtents = {
                    repeat: {
                        x: ['isBelow', 'isBelow', 'isBelow'],
                        y: ['isAbove', 'isAbove', 'isAbove']
                    },
                    facet: {
                        x: ['isBelow', 'isBelow', 'isBelow'],
                        y: ['isBelow', 'isAbove', 'isBelow']
                    }
                };
                it("should work with shared scales in " + specType + " views", function () {
                    for (var i = 0; i < hits[specType].length; i++) {
                        embed(util_1.spec(specType, 0, __assign({ type: type }, binding), { resolve: { scale: { x: 'shared', y: 'shared' } } }));
                        var parent_1 = util_1.parentSelector(specType, i);
                        var xscale = browser.execute('return view._runtime.scales.x.value.domain()').value;
                        var yscale = browser.execute('return view._runtime.scales.y.value.domain()').value;
                        var drag = browser.execute(util_1.brush(specType, i, parent_1)).value[0];
                        chai_1.assert[assertExtents[specType].x[i]](drag.intervals[0].extent[0], xscale[0], "iter: " + i);
                        chai_1.assert[assertExtents[specType].x[i]](drag.intervals[0].extent[1], xscale[1], "iter: " + i);
                        chai_1.assert[assertExtents[specType].y[i]](drag.intervals[1].extent[0], yscale[0], "iter: " + i);
                        chai_1.assert[assertExtents[specType].y[i]](drag.intervals[1].extent[1], yscale[1], "iter: " + i);
                        testRender(specType + "_" + i);
                    }
                });
            });
        }
        var _a;
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNsYXRlLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi90ZXN0LXJ1bnRpbWUvdHJhbnNsYXRlLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLDZCQUE0QjtBQUM1QiwrQkFXZ0I7QUFFaEIsQ0FBQyxZQUFLLEVBQUUsY0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVMsSUFBSSxFQUFFLEdBQUc7SUFDekMsUUFBUSxDQUFDLGVBQWEsSUFBSSxvQ0FBaUMsRUFBRTtRQUMzRCxJQUFNLElBQUksR0FBRyxVQUFVLENBQUM7UUFDeEIsSUFBTSxJQUFJLEdBQUcsV0FBVSxDQUFDLFFBQVEsQ0FBQztRQUNqQyxJQUFNLEtBQUssR0FBRyxjQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDL0IsSUFBTSxVQUFVLEdBQUcsbUJBQVksQ0FBQyxPQUFPLEVBQUUsd0JBQXNCLElBQU0sQ0FBQyxDQUFDO1FBQ3ZFLElBQU0sT0FBTyxHQUFHLElBQUksS0FBSyxZQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUMsSUFBSSxFQUFFLFFBQVEsRUFBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFFdkQsSUFBTSxZQUFZO1lBQ2hCLEdBQUMsY0FBTyxJQUFHO2dCQUNULENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxTQUFTLENBQUM7Z0JBQ3pCLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxTQUFTLENBQUM7YUFDMUI7WUFDRCxHQUFDLFlBQUssSUFBRztnQkFDUCxDQUFDLEVBQUUsQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDO2dCQUN6QixDQUFDLEVBQUUsQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDO2FBQzFCO2VBQ0YsQ0FBQztRQUVGLEVBQUUsQ0FBQyw0QkFBNEIsRUFBRTtZQUMvQixHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMs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RUFBQyxRQUFRLEVBQUUsQ0FBQyxFQUFFLFFBQVEsRUFBQyxFQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ2xELElBQU0sUUFBTSxHQUFHLHFCQUFjLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDO3dCQUMzQyxJQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLDhDQUE4QyxDQUFDLENBQUMsS0FBSyxDQUFDO3dCQUNyRixJQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLDhDQUE4QyxDQUFDLENBQUMsS0FBSyxDQUFDO3dCQUNyRixJQUFNLElBQUksR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLFlBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQyxFQUFFLFFBQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUNsRSxhQUFNLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxXQUFTLENBQUcsQ0FBQyxDQUFDO3dCQUMzRixhQUFNLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxXQUFTLENBQUcsQ0FBQyxDQUFDO3dCQUMzRixhQUFNLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxXQUFTLENBQUcsQ0FBQyxDQUFDO3dCQUMzRixhQUFNLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxXQUFTLENBQUcsQ0FBQyxDQUFDO3dCQUMzRixVQUFVLENBQUksUUFBUSxTQUFJLENBQUcsQ0FBQyxDQUFDO29CQUNqQyxDQUFDO2dCQUNILENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDOztJQUNILENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2Fzc2VydH0gZnJvbSAnY2hhaSc7XG5pbXBvcnQge1xuICBib3VuZCxcbiAgYnJ1c2gsXG4gIGNvbXBvc2l0ZVR5cGVzLFxuICBlbWJlZEZuLFxuICBoaXRzIGFzIGhpdHNNYXN0ZXIsXG4gIHBhcmVudFNlbGVjdG9yLFxuICBzcGVjLFxuICB0ZXN0UmVuZGVyRm4sXG4gIHR1cGxlcyxcbiAgdW5ib3VuZCxcbn0gZnJvbSAnLi91dGlsJztcblxuW2JvdW5kLCB1bmJvdW5kXS5mb3JFYWNoKGZ1bmN0aW9uKGJpbmQsIGlkeCkge1xuICBkZXNjcmliZShgVHJhbnNsYXRlICR7YmluZH0gaW50ZXJ2YWwgc2VsZWN0aW9ucyBhdCBydW50aW1lYCwgZnVuY3Rpb24oKSB7XG4gICAgY29uc3QgdHlwZSA9ICdpbnRlcnZhbCc7XG4gICAgY29uc3QgaGl0cyA9IGhpdHNNYXN0ZXIuaW50ZXJ2YWw7XG4gICAgY29uc3QgZW1iZWQgPSBlbWJlZEZuKGJyb3dzZXIpO1xuICAgIGNvbnN0IHRlc3RSZW5kZXIgPSB0ZXN0UmVuZGVyRm4oYnJvd3NlciwgYGludGVydmFsL3RyYW5zbGF0ZS8ke2JpbmR9YCk7XG4gICAgY29uc3QgYmluZGluZyA9IGJpbmQgPT09IGJvdW5kID8ge2JpbmQ6ICdzY2FsZXMnfSA6IHt9O1xuXG4gICAgY29uc3QgYXNzZXJ0RXh0ZW50ID0ge1xuICAgICAgW3VuYm91bmRdOiB7XG4gICAgICAgIHg6IFsnaXNBYm92ZScsICdpc0JlbG93J10sXG4gICAgICAgIHk6IFsnaXNCZWxvdycsICdpc0Fib3ZlJ11cbiAgICAgIH0sXG4gICAgICBbYm91bmRdOiB7XG4gICAgICAgIHg6IFsnaXNCZWxvdycsICdpc0Fib3ZlJ10sXG4gICAgICAgIHk6IFsnaXNBYm92ZScsICdpc0JlbG93J11cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCBtb3ZlIGJhY2stYW5kLWZvcnRoJywgZnVuY3Rpb24oKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGhpdHMudHJhbnNsYXRlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGVtYmVkKHNwZWMoJ3VuaXQnLCBpLCB7dHlwZSwgLi4uYmluZGluZ30pKTtcbiAgICAgICAgY29uc3QgZHJhZyA9IGJyb3dzZXIuZXhlY3V0ZShicnVzaCgnZHJhZycsIGkpKS52YWx1ZVswXTtcbiAgICAgICAgdGVzdFJlbmRlcihgJHtpfS0wYCk7XG4gICAgICAgIGNvbnN0IHRyYW5zbGF0ZSA9IGJyb3dzZXIuZXhlY3V0ZShicnVzaCgndHJhbnNsYXRlJywgaSwgbnVsbCwgYmluZCA9PT0gdW5ib3VuZCkpLnZhbHVlWzBdO1xuICAgICAgICBhc3NlcnRbYXNzZXJ0RXh0ZW50W2JpbmRdLnhbaV1dKHRyYW5zbGF0ZS5pbnRlcnZhbHNbMF0uZXh0ZW50WzBdLCBkcmFnLmludGVydmFsc1swXS5leHRlbnRbMF0pO1xuICAgICAgICBhc3NlcnRbYXNzZXJ0RXh0ZW50W2JpbmRdLnhbaV1dKHRyYW5zbGF0ZS5pbnRlcnZhbHNbMF0uZXh0ZW50WzFdLCBkcmFnLmludGVydmFsc1swXS5leHRlbnRbMV0pO1xuICAgICAgICBhc3NlcnRbYXNzZXJ0RXh0ZW50W2JpbmRdLnlbaV1dKHRyYW5zbGF0ZS5pbnRlcnZhbHNbMV0uZXh0ZW50WzBdLCBkcmFnLmludGVydmFsc1sxXS5leHRlbnRbMF0pO1xuICAgICAgICBhc3NlcnRbYXNzZXJ0RXh0ZW50W2JpbmRdLnlbaV1dKHRyYW5zbGF0ZS5pbnRlcnZhbHNbMV0uZXh0ZW50WzFdLCBkcmFnLmludGVydmFsc1sxXS5leHRlbnRbMV0pO1xuICAgICAgICB0ZXN0UmVuZGVyKGAke2l9LTFgKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgd29yayB3aXRoIGJpbm5lZCBkb21haW5zJywgZnVuY3Rpb24oKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGhpdHMuYmlucy5sZW5ndGg7IGkrKykge1xuICAgICAgICBlbWJlZChzcGVjKCd1bml0JywgMSwge3R5cGUsIC4uLmJpbmRpbmcsIGVuY29kaW5nczogWyd5J119LCB7XG4gICAgICAgICAgeDoge2FnZ3JlZ2F0ZTogJ2NvdW50JywgZmllbGQ6ICcqJywgdHlwZTogJ3F1YW50aXRhdGl2ZSd9LFxuICAgICAgICAgIHk6IHtiaW46IHRydWV9LFxuICAgICAgICAgIGNvbG9yOiB7dmFsdWU6ICdzdGVlbGJsdWUnLCBmaWVsZDogbnVsbCwgdHlwZTogbnVsbH1cbiAgICAgICAgfSkpO1xuICAgICAgICBjb25zdCBkcmFnID0gYnJvd3Nlci5leGVjdXRlKGJydXNoKCdiaW5zJywgaSkpLnZhbHVlWzBdO1xuICAgICAgICB0ZXN0UmVuZGVyKGBiaW5zXyR7aX0tMGApO1xuICAgICAgICBjb25zdCB0cmFuc2xhdGUgPSBicm93c2VyLmV4ZWN1dGUoYnJ1c2goJ2JpbnNfdHJhbnNsYXRlJywgaSwgbnVsbCwgYmluZCA9PT0gdW5ib3VuZCkpLnZhbHVlWzBdO1xuICAgICAgICBhc3NlcnRbYXNzZXJ0RXh0ZW50W2JpbmRdLnlbaV1dKHRyYW5zbGF0ZS5pbnRlcnZhbHNbMF0uZXh0ZW50WzBdLCBkcmFnLmludGVydmFsc1swXS5leHRlbnRbMF0pO1xuICAgICAgICBhc3NlcnRbYXNzZXJ0RXh0ZW50W2JpbmRdLnlbaV1dKHRyYW5zbGF0ZS5pbnRlcnZhbHNbMF0uZXh0ZW50WzFdLCBkcmFnLmludGVydmFsc1swXS5leHRlbnRbMV0pO1xuICAgICAgICB0ZXN0UmVuZGVyKGBiaW5zXyR7aX0tMWApO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB3b3JrIHdpdGggdGVtcG9yYWwgZG9tYWlucycsIGZ1bmN0aW9uKCkge1xuICAgICAgY29uc3QgdmFsdWVzID0gdHVwbGVzLm1hcCgoZCkgPT4gKHsuLi5kLCBhOiBuZXcgRGF0ZSgyMDE3LCBkLmEpfSkpO1xuICAgICAgY29uc3QgdG9OdW1iZXIgPSAnWzBdLmludGVydmFsc1swXS5leHRlbnQubWFwKChkKSA9PiArZCknO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGhpdHMudHJhbnNsYXRlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGVtYmVkKHNwZWMoJ3VuaXQnLCBpLCB7dHlwZSwgLi4uYmluZGluZywgZW5jb2RpbmdzOiBbJ3gnXX0sXG4gICAgICAgICAge3ZhbHVlcywgeDoge3R5cGU6ICd0ZW1wb3JhbCd9fSkpO1xuICAgICAgICBjb25zdCBkcmFnID0gYnJvd3Nlci5leGVjdXRlKGJydXNoKCdkcmFnJywgaSkgKyB0b051bWJlcikudmFsdWU7XG4gICAgICAgIHRlc3RSZW5kZXIoYHRlbXBvcmFsXyR7aX0tMGApO1xuICAgICAgICBjb25zdCB0cmFuc2xhdGUgPSBicm93c2VyLmV4ZWN1dGUoYnJ1c2goJ3RyYW5zbGF0ZScsIGksIG51bGwsIGJpbmQgPT09IHVuYm91bmQpICsgdG9OdW1iZXIpLnZhbHVlO1xuICAgICAgICBhc3NlcnRbYXNzZXJ0RXh0ZW50W2JpbmRdLnhbaV1dKHRyYW5zbGF0ZVswXSwgZHJhZ1swXSk7XG4gICAgICAgIGFzc2VydFthc3NlcnRFeHRlbnRbYmluZF0ueFtpXV0odHJhbnNsYXRlWzFdLCBkcmFnWzFdKTtcbiAgICAgICAgdGVzdFJlbmRlcihgdGVtcG9yYWxfJHtpfS0xYCk7XG4gICAgICB9XG5cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgd29yayB3aXRoIGxvZy9wb3cgc2NhbGVzJywgZnVuY3Rpb24oKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGhpdHMudHJhbnNsYXRlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGVtYmVkKHNwZWMoJ3VuaXQnLCBpLCB7dHlwZSwgLi4uYmluZGluZ30sIHtcbiAgICAgICAgICB4OiB7c2NhbGU6IHt0eXBlOiAncG93JywgZXhwb25lbnQ6IDEuNX19LFxuICAgICAgICAgIHk6IHtzY2FsZToge3R5cGU6ICdsb2cnfX1cbiAgICAgICAgfSkpO1xuICAgICAgICBjb25zdCBkcmFnID0gYnJvd3Nlci5leGVjdXRlKGJydXNoKCdkcmFnJywgaSkpLnZhbHVlWzBdO1xuICAgICAgICB0ZXN0UmVuZGVyKGBsb2dwb3dfJHtpfS0wYCk7XG4gICAgICAgIGNvbnN0IHRyYW5zbGF0ZSA9IGJyb3dzZXIuZXhlY3V0ZShicnVzaCgndHJhbnNsYXRlJywgaSwgbnVsbCwgYmluZCA9PT0gdW5ib3VuZCkpLnZhbHVlWzBdO1xuICAgICAgICBhc3NlcnRbYXNzZXJ0RXh0ZW50W2JpbmRdLnhbaV1dKHRyYW5zbGF0ZS5pbnRlcnZhbHNbMF0uZXh0ZW50WzBdLCBkcmFnLmludGVydmFsc1swXS5leHRlbnRbMF0pO1xuICAgICAgICBhc3NlcnRbYXNzZXJ0RXh0ZW50W2JpbmRdLnhbaV1dKHRyYW5zbGF0ZS5pbnRlcnZhbHNbMF0uZXh0ZW50WzFdLCBkcmFnLmludGVydmFsc1swXS5leHRlbnRbMV0pO1xuICAgICAgICBhc3NlcnRbYXNzZXJ0RXh0ZW50W2JpbmRdLnlbaV1dKHRyYW5zbGF0ZS5pbnRlcnZhbHNbMV0uZXh0ZW50WzBdLCBkcmFnLmludGVydmFsc1sxXS5leHRlbnRbMF0pO1xuICAgICAgICBhc3NlcnRbYXNzZXJ0RXh0ZW50W2JpbmRdLnlbaV1dKHRyYW5zbGF0ZS5pbnRlcnZhbHNbMV0uZXh0ZW50WzFdLCBkcmFnLmludGVydmFsc1sxXS5leHRlbnRbMV0pO1xuICAgICAgICB0ZXN0UmVuZGVyKGBsb2dwb3dfJHtpfS0xYCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAoYmluZCA9PT0gdW5ib3VuZCkge1xuICAgICAgaXQoJ3Nob3VsZCB3b3JrIHdpdGggb3JkaW5hbC9ub21pbmFsIGRvbWFpbnMnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBoaXRzLnRyYW5zbGF0ZS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGVtYmVkKHNwZWMoJ3VuaXQnLCBpLCB7dHlwZSwgLi4uYmluZGluZ30sIHtcbiAgICAgICAgICAgIHg6IHt0eXBlOiAnb3JkaW5hbCd9LCB5OiB7dHlwZTogJ25vbWluYWwnfVxuICAgICAgICAgIH0pKTtcbiAgICAgICAgICBjb25zdCBkcmFnID0gYnJvd3Nlci5leGVjdXRlKGJydXNoKCdkcmFnJywgaSkpLnZhbHVlWzBdO1xuICAgICAgICAgIHRlc3RSZW5kZXIoYG9yZF8ke2l9LTBgKTtcbiAgICAgICAgICBjb25zdCB0cmFuc2xhdGUgPSBicm93c2VyLmV4ZWN1dGUoYnJ1c2goJ3RyYW5zbGF0ZScsIGksIG51bGwsIHRydWUpKS52YWx1ZVswXTtcbiAgICAgICAgICBhc3NlcnRbYXNzZXJ0RXh0ZW50W2JpbmRdLnhbaV1dKHRyYW5zbGF0ZS5pbnRlcnZhbHNbMF0uZXh0ZW50WzBdLCBkcmFnLmludGVydmFsc1swXS5leHRlbnRbMF0pO1xuICAgICAgICAgIGFzc2VydFthc3NlcnRFeHRlbnRbYmluZF0ueFtpXV0odHJhbnNsYXRlLmludGVydmFsc1swXS5leHRlbnRbMV0sIGRyYWcuaW50ZXJ2YWxzWzBdLmV4dGVudFsxXSk7XG4gICAgICAgICAgYXNzZXJ0W2Fzc2VydEV4dGVudFtiaW5kXS55W2ldXSh0cmFuc2xhdGUuaW50ZXJ2YWxzWzFdLmV4dGVudFswXSwgZHJhZy5pbnRlcnZhbHNbMV0uZXh0ZW50WzBdKTtcbiAgICAgICAgICBhc3NlcnRbYXNzZXJ0RXh0ZW50W2JpbmRdLnlbaV1dKHRyYW5zbGF0ZS5pbnRlcnZhbHNbMV0uZXh0ZW50WzFdLCBkcmFnLmludGVydmFsc1sxXS5leHRlbnRbMV0pO1xuICAgICAgICAgIHRlc3RSZW5kZXIoYG9yZF8ke2l9LTFgKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbXBvc2l0ZVR5cGVzLmZvckVhY2goZnVuY3Rpb24oc3BlY1R5cGUpIHtcbiAgICAgICAgY29uc3QgYXNzZXJ0RXh0ZW50cyA9IHtcbiAgICAgICAgICByZXBlYXQ6IHtcbiAgICAgICAgICAgIHg6IFsnaXNCZWxvdycsICdpc0JlbG93JywgJ2lzQmVsb3cnXSxcbiAgICAgICAgICAgIHk6IFsnaXNBYm92ZScsICdpc0Fib3ZlJywgJ2lzQWJvdmUnXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZmFjZXQ6IHtcbiAgICAgICAgICAgIHg6IFsnaXNCZWxvdycsICdpc0JlbG93JywgJ2lzQmVsb3cnXSxcbiAgICAgICAgICAgIHk6IFsnaXNCZWxvdycsICdpc0Fib3ZlJywgJ2lzQmVsb3cnXVxuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgaXQoYHNob3VsZCB3b3JrIHdpdGggc2hhcmVkIHNjYWxlcyBpbiAke3NwZWNUeXBlfSB2aWV3c2AsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaGl0c1tzcGVjVHlwZV0ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGVtYmVkKHNwZWMoc3BlY1R5cGUsIDAsIHt0eXBlLCAuLi5iaW5kaW5nfSxcbiAgICAgICAgICAgICAge3Jlc29sdmU6IHtzY2FsZToge3g6J3NoYXJlZCcsIHk6ICdzaGFyZWQnfX19KSk7XG4gICAgICAgICAgICBjb25zdCBwYXJlbnQgPSBwYXJlbnRTZWxlY3RvcihzcGVjVHlwZSwgaSk7XG4gICAgICAgICAgICBjb25zdCB4c2NhbGUgPSBicm93c2VyLmV4ZWN1dGUoJ3JldHVybiB2aWV3Ll9ydW50aW1lLnNjYWxlcy54LnZhbHVlLmRvbWFpbigpJykudmFsdWU7XG4gICAgICAgICAgICBjb25zdCB5c2NhbGUgPSBicm93c2VyLmV4ZWN1dGUoJ3JldHVybiB2aWV3Ll9ydW50aW1lLnNjYWxlcy55LnZhbHVlLmRvbWFpbigpJykudmFsdWU7XG4gICAgICAgICAgICBjb25zdCBkcmFnID0gYnJvd3Nlci5leGVjdXRlKGJydXNoKHNwZWNUeXBlLCBpLCBwYXJlbnQpKS52YWx1ZVswXTtcbiAgICAgICAgICAgIGFzc2VydFthc3NlcnRFeHRlbnRzW3NwZWNUeXBlXS54W2ldXShkcmFnLmludGVydmFsc1swXS5leHRlbnRbMF0sIHhzY2FsZVswXSwgYGl0ZXI6ICR7aX1gKTtcbiAgICAgICAgICAgIGFzc2VydFthc3NlcnRFeHRlbnRzW3NwZWNUeXBlXS54W2ldXShkcmFnLmludGVydmFsc1swXS5leHRlbnRbMV0sIHhzY2FsZVsxXSwgYGl0ZXI6ICR7aX1gKTtcbiAgICAgICAgICAgIGFzc2VydFthc3NlcnRFeHRlbnRzW3NwZWNUeXBlXS55W2ldXShkcmFnLmludGVydmFsc1sxXS5leHRlbnRbMF0sIHlzY2FsZVswXSwgYGl0ZXI6ICR7aX1gKTtcbiAgICAgICAgICAgIGFzc2VydFthc3NlcnRFeHRlbnRzW3NwZWNUeXBlXS55W2ldXShkcmFnLmludGVydmFsc1sxXS5leHRlbnRbMV0sIHlzY2FsZVsxXSwgYGl0ZXI6ICR7aX1gKTtcbiAgICAgICAgICAgIHRlc3RSZW5kZXIoYCR7c3BlY1R5cGV9XyR7aX1gKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbn0pO1xuIl19